<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="<%= name %> GraphQL documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= title || name %></title>
    <link rel="stylesheet" href="<%= base_url %>/assets/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
    <script>

    document.addEventListener("DOMContentLoaded", function(event) {
      // Add anchors
      anchors.options = {
        placement: 'left',
        visible: 'hover',
        icon: 'Â¶'
      };
      anchors.add('h2, h3, h4, h5, h6, .anchored');

      // Add listener for search filter input
      const sidebarDiv = document.getElementById('sidebar');
      const searchDiv = sidebarDiv.querySelector('#search')

      if (searchDiv) {
        const searchInput = searchDiv.querySelector('input');
        const menuElements = sidebarDiv.querySelectorAll('ul.menu-root');

        const listener = debounce((event) => {
          const searchValue = event.target.value;
          applySearchFilter(searchValue, menuElements)
        }, 500);

        searchInput.addEventListener('input', listener);
      }

      // Resize sidebar functionality
      initializeSidebarResize();
    });

    function initializeSidebarResize() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) {
        return;
      }

      const minWidth = 200;
      const maxWidth = 350;

      // Restore saved width from sessionStorage
      const savedWidth = sessionStorage.getItem('sidebarWidth');
      if (savedWidth) {
        sidebar.style.width = savedWidth;
      }

      // Create resize handle as a sibling to sidebar (not inside it)
      const resizeHandle = document.createElement('div');
      resizeHandle.className = 'resize-handle';

      // Position handle at current sidebar width
      if (savedWidth) {
        resizeHandle.style.left = savedWidth;
      }

      // Insert after sidebar
      sidebar.parentNode.insertBefore(resizeHandle, sidebar.nextSibling);

      // Track resize state
      let isResizing = false;
      let startX = 0;
      let startWidth = 0;

      // Mouse down on handle
      resizeHandle.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startWidth = sidebar.offsetWidth;

        // Prevent text selection while dragging
        e.preventDefault();
        document.body.style.userSelect = 'none';
        document.body.style.cursor = 'ew-resize';
      });

      // Mouse move
      document.addEventListener('mousemove', function(e) {
        if (!isResizing) return;

        const dx = e.clientX - startX;
        const newWidth = startWidth + dx;

        // Apply constraints
        if (newWidth >= minWidth && newWidth <= maxWidth) {
          sidebar.style.width = newWidth + 'px';
          resizeHandle.style.left = newWidth + 'px';
        }
      });

      // Mouse up
      document.addEventListener('mouseup', function() {
        if (isResizing) {
          isResizing = false;
          document.body.style.userSelect = '';
          document.body.style.cursor = '';

          // Save the new width to sessionStorage
          sessionStorage.setItem('sidebarWidth', sidebar.style.width);
        }
      });
    }

    function debounce(func, wait) {
      let timeout;

      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };

        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function applySearchFilter(searchValue, menuElements) {
      menuElements.forEach(menuElement => {
        const listElements = menuElement.getElementsByTagName('li');
        let hasVisibleElements = false;
        Array.from(listElements).forEach(listElement => {
          let contains = true
          if (searchValue.length > 0) {
            const anchorElement = listElement.querySelector('a');
            const textContent = anchorElement.innerText;
            contains = textContent.toLowerCase().includes(searchValue.toLowerCase());
          }

          // Hide the list element if its text does not contain the search value
          listElement.style.display = contains ? '' : 'none';

          if (contains) {
            hasVisibleElements = true;
          }
        });

        // Hide the entire menu if none of the list items are visible
        const menuParentElement = menuElement.closest('li')
        menuParentElement.style.display = hasVisibleElements ? '' : 'none';
      });
    }
    </script>
  </head>
  <body>

    <div id="wrap">
      <div id="header">
      </div>
      <div id="sidebar">
        <%= include.('sidebar.html') %>
      </div>
      <div id="content">

        <%= contents %>

      </div>

      <!-- mobile only -->
      <div id="mobile-header">
        <a class="menu-button" onclick="document.body.classList.toggle('sidebar-open')"></a>
        <a class="logo" href="<%= base_url && !base_url.empty? ? base_url : '/' %>">

        </a>
      </div>
      <div id="mobile-shade"></div>

    </div>

  </body>
</html>
